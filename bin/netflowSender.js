var NetflowPacketHeaderV9 = function() {

	return {
	'versionNumber' : Number(),
	'count' : Number(),
	'sysUptime' : Number(),
	'unixSecs' : Number(),
	'sequenceNumber' : Number(),
	'sourceId' : Number()
	}

};

//Data FlowSet
var NetflowPacketV9Data = '010002a43a9897583a9897580000004700000001000200010a2c58080a2a062d1148b8f6003500000a2a160218181000000000003a9897583a9897580000004700000001000200010a2c58080a2a062d1148b8f6003500000a2a160218181001000000003a9897583a989758000000a100000001000100020a2a062d0a2c580811000035b8f600000a2c6c5818181000000000003a9897583a989758000000a100000001000100020a2a062d0a2c580811480035b8f600000a2c6c5818181001000000003a98df243a97f2440000065800000022000100000a2a1602e000000211c007c107c100000000000000181000000000003a98aa8c3a98aa8c0000004c00000001000200010a2c6c580a2a0a011148007b007b00000a2a160218181000000000003a98aa8c3a98aa8c0000004c00000001000200010a2c6c580a2a0a011148007b007b00000a2a160218181001000000003a98aa8c3a98aa8c0000004c00000001000100020a2a0a010a2c6c5811c0007b007b00000a2c6c5818181000000000003a98aa8c3a98aa8c0000004c00000001000100020a2a0a010a2c6c581148007b007b00000a2c6c5818181001000000003a98af143a98af140000004700000001000200010a2c58080a2a062d1148cde2003500000a2a160218181001000000003a98af143a98af14000000a100000001000100020a2a062d0a2c580811000035cde200000a2c6c5818181000000000003a98af183a98af18000000a100000001000100020a2a062d0a2c580811480035cde200000a2c6c5818181001000000003a98af143a98af140000004700000001000200010a2c58080a2a062d1148cde2003500000a2a160218181000000000003a98f1603a980c94000005d00000001f000100000a2a1603e000000211c007c107c10000000000000018100000000000';
//Template FlowSet
//var NetflowPacketV9Data = '000000ac0101001300150004001600040001000400020004000a0002000e000200080004000c0004000400010005000100070002000b00020030000100330001000f0004000d00010009000100060001003d00010100001500150004001600040001000400020004000a0002000e000200080004000c0004000400010005000100070002000b00020030000100330001000f0004000d00010009000100060001003d00010011000200100002010003943a968d343a968d340000004700000001000200010a2c58080a2a062d1148c6c2003500000a2a160218181000000000003a968d343a968d340000004700000001000200010a2c58080a2a062d1148c6c2003500000a2a160218181001000000003a968d343a968d34000000a100000001000100020a2a062d0a2c580811000035c6c200000a2c6c5818181000000000003a968d343a968d34000000a100000001000100020a2a062d0a2c580811480035c6c200000a2c6c5818181001000000003a96c1c83a96c0fc000000b600000004000100000a2a081a0a2a16fc060000316aaa00000000000018181b00000000003a96c3b03a96c1c8000000dd00000005000100000a2a081a0a2a16fc0600003161ad00000000000018181b00000000003a968e643a968e640000003800000001000100000a2a41b10a2a16fc01000000030300000000000018161000000000003a969e343a968e840000024800000008000100020a2a080b0a9801d21100e40200a100000a2c6c5810181000000000003a969e343a968e840000024800000008000100020a2a080b0a9801d21148e40200a100000a2c6c5810181001000000003a96a5003a96a5000000004700000001000200010a2c58080a2a062d1148ed3b003500000a2a160218181000000000003a96a5003a96a5000000004700000001000200010a2c58080a2a062d1148ed3b003500000a2a160218181001000000003a96da103a96d948000000b600000004000100000a2a081a0a2a16fc060000316ff000000000000018181b00000000003a96dc003a96da18000000dd00000005000100000a2a081a0a2a16fc06000031db7c00000000000018181b00000000003a96a5003a96a500000000a100000001000100020a2a062d0a2c580811000035ed3b00000a2c6c5818181000000000003a96a5003a96a500000000a100000001000100020a2a062d0a2c580811480035ed3b00000a2c6c5818181001000000003a96b6903a96b6900000004c00000001000200010a2c6c580a2a0a011148007b007b00000a2a160218181000000000003a96b6903a96b6900000004c00000001000200010a2c6c580a2a0a011148007b007b00000a2a160218181001000000003a96b6903a96b6900000004c00000001000100020a2a0a010a2c6c5811c0007b007b00000a2c6c5818181000000000003a96b6903a96b6900000004c00000001000100020a2a0a010a2c6c581148007b007b00000a2c6c581818100100000000';


var dgram = require('dgram');
var client = dgram.createSocket("udp4");

//var message = new Buffer(newV9Flow(), 'hex');
var message = newV9Flow();

var host = 'localhost';
var port = 9001;

//console.log('Sending message:\n'+message);

client.send(message, 0, message.length, 9001, "localhost", function(err, bytes) {

	console.log('Sending to host: '+host+' port: '+port+' bytes: '+bytes);
	client.close();

});

function toHex(i, pad) {

	if (typeof(pad) === 'undefined' || pad === null) {

		pad = 2;

	} 

	var strToParse = i.toString(16);

	while (strToParse.length < pad) {

		strToParse = "0" + strToParse;

	}

	var finalVal =  parseInt(strToParse, 16);

	if ( finalVal < 0 ) {

		finalVal = 0xFFFFFFFF + finalVal + 1;

	} else {

		finalVal = strToParse;

	}

	return finalVal;

}

function newV9Flow() {

	var header = new NetflowPacketHeaderV9;
	header.versionNumber = '0009';
	header.count = '000e';
	header.sysUptime = '3A98fef4';
	var timestamp = parseInt(new Date().getTime()/1000);
//	console.log(timestamp);
	header.unixSecs = toHex(timestamp, 8);
//	console.log(header.unixSecs);
	header.sequenceNumber = '0021be97';
	header.sourceId = '00000000';
	var flow = String(header.versionNumber+header.count+header.sysUptime+header.unixSecs+header.sequenceNumber+header.sourceId+NetflowPacketV9Data);

	return new Buffer(flow, 'hex');

}